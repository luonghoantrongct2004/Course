@model User

<style>
    .swal-custom-popup {
        background-color: #a52effa3;
        color: black;
    }

    .swal-custom-title {
        color: black;
    }

    .swal-custom-confirm, .swal-custom-cancel {
        background-color: #ffffffd9;
        color: #000000;
    }

        .swal-custom-confirm:hover, .swal-custom-cancel:hover {
            background-color: #ebebeb;
            color: black;
        }

</style>
<div class="p-6">
    <div class="flex flex-col justify-between gap-5 mb-6 sm:flex-row">
        <div>
            <h3 class="mb-1 text-xl font-semibold leading-6 text-slate-800">
                Chỉnh Sửa Học Sinh
            </h3>
            <p class="text-sm text-slate-600">
                Cập nhật thông tin học sinh
            </p>
        </div>
        <div>
            <a href="/admin/student"
               class="flex items-center px-4 py-3 text-sm text-white rounded-lg shadow-xs gap bg-primary">
                <svg width="24"
                     height="24"
                     viewBox="0 0 24 24"
                     fill="none"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 11H9L12.29 7.71C12.3837 7.61704 12.4581 7.50644 12.5089 7.38458C12.5597 7.26272 12.5858 7.13201 12.5858 7C12.5858 6.86799 12.5597 6.73728 12.5089 6.61542C12.4581 6.49356 12.3837 6.38296 12.29 6.29C12.1026 6.10375 11.8492 5.99921 11.585 5.99921C11.3208 5.99921 11.0674 6.10375 10.88 6.29L6.59 10.59C6.21441 10.9633 6.00223 11.4704 6 12C6.00487 12.5261 6.21684 13.0291 6.59 13.4L10.88 17.7C10.9732 17.7926 11.0838 17.8659 11.2054 17.9157C11.3269 17.9656 11.4571 17.991 11.5885 17.9906C11.7199 17.9901 11.8499 17.9638 11.9712 17.913C12.0924 17.8623 12.2024 17.7882 12.295 17.695C12.3876 17.6018 12.4609 17.4912 12.5107 17.3696C12.5606 17.2481 12.586 17.1179 12.5856 16.9865C12.5851 16.8551 12.5588 16.7251 12.508 16.6038C12.4573 16.4826 12.3832 16.3726 12.29 16.28L9 13H19C19.2652 13 19.5196 12.8946 19.7071 12.7071C19.8946 12.5196 20 12.2652 20 12C20 11.7348 19.8946 11.4804 19.7071 11.2929C19.5196 11.1054 19.2652 11 19 11Z"
                          fill="currentColor" />
                </svg>
                Trở Về
            </a>
        </div>
    </div>

    <div class="p-5 bg-white rounded-lg">
        <form id="createForm" enctype="multipart/form-data" method="post" action="/admin/student/edit">
            <input type="hidden" name="id" value="@Model.Id" />
            <div class="grid grid-cols-1 gap-5 lg:grid-cols-2">
                <div class="border-b border-slate-200 col-span-full">
                    <h3 class="mb-2 text-xl font-semibold leading-6 text-mainblack">Thông Tin Tổng Quát</h3>
                </div>
                <div class="col-span-full">
                    <div class="flex flex-col gap-5 md:items-center md:flex-row">
                        <div>
                            <p class="mb-3 text-sm text-slate-500">Chỉ hỗ trợ .JPG, .JPEG, or .PNG file.</p>
                            <div class="flex flex-col gap-5 sm:flex-row sm:items-center">
                                <label for="photo" class="px-5 py-3 text-sm font-medium underline transition border-b rounded-lg cursor-pointer bg-violet-100 hover:text-white hover:bg-primary text-primary">
                                    Tải Ảnh Lên
                                    <input type="file" name="photo" id="photo" accept=".jpg,.jpeg,.png" onchange="previewImage(event)" />
                                </label>

                                <!-- Thẻ img để hiển thị ảnh đã tải lên -->
                                @if (Model.Image != null)
                                {
                                    <img id="preview" src="@Model.Image" alt="Preview Image" class="mt-3" style="max-width: 200px; max-height: 200px;" />
                                }

                                <script>
                                    function previewImage(event) {
                                        var reader = new FileReader();
                                        reader.onload = function () {
                                            var preview = document.getElementById('preview');
                                            preview.src = reader.result;
                                            preview.classList.remove('hidden');  // Hiển thị ảnh sau khi tải lên
                                        }
                                        reader.readAsDataURL(event.target.files[0]); // Đọc file đã chọn dưới dạng URL
                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-span-1">
                    <label for="fname" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Họ và Tên *</label>
                    <input type="text" name="FullName" id="fname" class="w-full px-4 py-2 text-sm border rounded-lg text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600" value="@Model.FullName" placeholder="Nhập họ và tên" required />
                </div>

                <div class="col-span-1">
                    <label for="Password" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Mật khẩu</label>
                    <input type="password" id="Password" name="Password" class="w-full px-4 py-2 border rounded-lg text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600" />
                </div>

                <div class="col-span-1">
                    <label for="email" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Email</label>
                    <input type="email" name="Email" id="email" class="w-full px-4 py-2 border rounded-lg text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600" value="@Model.Email" placeholder="Nhập email" required />
                </div>

                <div class="col-span-1">
                    <label for="phone" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Số điện thoại</label>
                    <input type="text" name="PhoneNumber" id="phon" class="w-full px-4 py-2 border rounded-lg text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600" value="@Model.PhoneNumber" placeholder="Nhập số điện thoại" />
                </div>

                <div class="border-b border-slate-200 col-span-full">
                    <h3 class="mb-2 text-xl font-semibold leading-6 text-mainblack">Địa chỉ</h3>
                </div>

                <div class="col-span-1">
                    <label for="address" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Địa chỉ</label>
                    <input type="text" name="Address" id="address" class="w-full px-4 py-2 border rounded-lg text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600" value="@Model.Address" placeholder="Nhập địa chỉ" />
                </div>

                <div class="col-span-1">
                    <label for="status" class="block mb-2 text-sm font-medium leading-6 text-mainblack">Trạng thái *</label>
                    <select name="Status" id="status" class="w-full px-4 py-2 text-sm border rounded-lg form-select text-mainblack placeholder:text-sm focus:ring-0 focus:border-primary h-11 border-slate-200 placeholder:text-slate-600">
                        @if (Model.Status == "Active")
                        {
                            <option value="Active" selected>Kích hoạt</option>
                        }
                        else
                        {
                            <option value="Active">Kích hoạt</option>
                        }

                        @if (Model.Status == "InActive")
                        {
                            <option value="InActive" selected>Không kích hoạt</option>
                        }
                        else
                        {
                            <option value="InActive">Không kích hoạt</option>
                        }

                    </select>
                </div>
            </div>

            <div class="flex flex-col gap-4 mt-6 sm:flex-row">
                <a href="/admin/instructure" class="px-12 py-3 text-sm font-medium leading-6 text-center text-red-500 border border-red-200 rounded-lg sm:text-base">Hủy</a>
                <button type="submit" class="px-12 py-3 text-sm font-medium leading-6 text-center text-white border rounded-lg bg-primary sm:text-base">Cập nhật</button>
            </div>
        </form>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            document.getElementById('createForm').onsubmit = function (e) {
                e.preventDefault();

                Swal.fire({
                    title: 'Bạn có chắc chắn muốn sửa?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Sửa',
                    cancelButtonText: 'Hủy',
                    customClass: {
                        confirmButton: 'swal-custom-confirm',
                        cancelButton: 'swal-custom-cancel',
                        title: 'swal-custom-title',
                        popup: 'swal-custom-popup'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        var formData = new FormData(this);

                        fetch('/admin/student/edit', {
                            method: 'POST',
                            body: formData
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: data.message,
                                        icon: 'success',
                                        confirmButtonText: 'OK',
                                        customClass: {
                                            confirmButton: 'swal-custom-confirm',
                                            popup: 'swal-custom-popup'
                                        }
                                    }).then(() => {
                                        window.location.href = '/admin/student';
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Lỗi!',
                                        text: data.message,
                                        icon: 'error',
                                        confirmButtonText: 'OK',
                                        customClass: {
                                            confirmButton: 'swal-custom-confirm',
                                            popup: 'swal-custom-popup'
                                        }
                                    });
                                }
                            })
                            .catch(error => {
                                Swal.fire({
                                    title: 'Lỗi!',
                                    text: 'Có lỗi xảy ra khi gửi dữ liệu. Vui lòng thử lại.',
                                    icon: 'error',
                                    confirmButtonText: 'OK',
                                    customClass: {
                                        confirmButton: 'swal-custom-confirm',
                                        popup: 'swal-custom-popup'
                                    }
                                });
                                console.error('Error:', error);
                            });
                    }
                });
            };
        </script>
    </div>
</div>

