@model ProfileViewModel

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/akiran/theia-sticky-sidebar@1.9.0/dist/theia-sticky-sidebar.min.js"></script>
<div class="page-content">
    <div class="container">
        <div class="row">
            <div class="col-xl-3 col-lg-3 theiaStickySidebar">
                <div class="settings-widget dash-profile">
                    <div class="settings-menu">
                        <div class="profile-bg">
                            <div class="profile-img">
                                <a href="/profile/account"><img src="~/assets/img/user/user16.jpg" alt="Img"></a>
                            </div>
                        </div>
                        <div class="profile-group">
                            <div class="profile-name text-center">
                                <h4><a href="/profile/account">@Model.User.FullName</a></h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-widget account-settings">
                    <div class="settings-menu">
                        <h3>Tổng quát</h3>
                        <ul>
                            <li class="nav-item ">
                                <a href="/profile" class="nav-link">
                                    <i class="bx bxs-tachometer"></i>Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/profile/account" class="nav-link">
                                    <i class="bx bxs-user"></i>Thông tin cá nhân
                                </a>
                            </li>
                            <li class="nav-item active">
                                <a href="/profile/courseprofile" class="nav-link">
                                    <i class="bx bxs-graduation"></i>Khóa học đã mua
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/home/StudentExam" class="nav-link">
                                    <i class="bx bxs-shapes"></i>Bài thi
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/profile/historyOrder" class="nav-link">
                                    <i class="bx bxs-cart"></i>Lịch sử mua
                                </a>
                            </li>
                        </ul>
                        <h3>Account Settings</h3>
                        <ul>
                            <li class="nav-item">
                                <a href="index-2.html" class="nav-link">
                                    <i class="bx bxs-log-out"></i>Đăng xuất
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-xl-9 col-lg-9">
                <div class="settings-widget card-info">
                    <div class="settings-menu p-0">
                        <div class="profile-heading">
                            <h3>Những khóa học đã mua</h3>
                        </div>
                        <div class="checkout-form pb-0">
                            <div class="wishlist-tab">
                                <div class="form-group d-flex align-items-center pb-4">
                                    <div class="flex-grow-1 mr-2">
                                        <label for="startDate">Từ ngày:</label>
                                        <input type="date" id="startDate" name="startDate" class="form-control" />
                                    </div>
                                    <div class="flex-grow-1 mr-2">
                                        <label for="endDate">Đến ngày:</label>
                                        <input type="date" id="endDate" name="endDate" class="form-control" />
                                    </div>
                                    <div class="flex-grow-1" style="margin-top: 30px;">
                                        <button type="button" class="btn btn-primary w-100" onclick="filterByDateCourse()">Lọc</button>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="enroll-courses">
                                    <div class="row">
                                         @foreach (var item in Model.UserCourses)
                                        {
                                            <div class="col-xxl-4 col-md-6 d-flex">
                                                <div class="course-box flex-fill" data-date="@item.EnrollDate.ToString("yyyy-MM-dd")">
                                                    <div class="product">
                                                        <div class="product-img">
                                                            <a href="/home/detail?id=@item.CourseID">
                                                                <img class="img-fluid" alt="Img" src="@item.Course.Image">
                                                            </a>
                                                            @{
                                                                var price = item.Course.Price * (1 - item.Course.Discount / 100.0M);
                                                            }
                                                            <div class="price">
                                                                <h3>@item.Course.Price.ToString("N0") <span>@price.ToString("N0")</span></h3>
                                                            </div>
                                                        </div>
                                                        <div class="product-content">
                                                            <div class="course-group d-flex">
                                                                <div class="course-group-img d-flex">
                                                                    <a href="/home/detail?id=@item.CourseID"><img src="~/assets/img/user/user2.jpg" alt="Img" class="img-fluid"></a>
                                                                    <div class="course-name">
                                                                        <h4><a href="/home/detail?id=@item.CourseID">@item.Course.Author.FullName</a></h4>
                                                                    </div>
                                                                </div>
                                                                <div class="course-share d-flex align-items-center justify-content-center">
                                                                </div>
                                                            </div>
                                                            <h3 class="title instructor-text">
                                                                <a href="/home/detail?id=@item.CourseID">
                                                                    @item.Course.Title
                                                                </a>
                                                            </h3>
                                                            @{
                                                                var chapters = item.Course.Chapters?.ToList();
                                                                double totalCourseDuration = chapters?
                                                                .Sum(chapter => chapter.Lessons.Sum(lesson => lesson.Duration)) ?? 0;

                                                                int hours = (int)(totalCourseDuration / 3600);
                                                                int minutes = (int)((totalCourseDuration % 3600) / 60);
                                                                int seconds = (int)(totalCourseDuration % 60);
                                                            }
                                                            <p>

                                                                <div class="course-info d-flex align-items-center">
                                                                    <div class="rating-img d-flex align-items-center">
                                                                        <img src="~/assets/img/icon/icon-01.svg" alt="Img">
                                                                        <p>@item.Course.Chapters.Sum(chapter => chapter.Lessons.Count())</p>
                                                                    </div>
                                                                    <div class="course-view d-flex align-items-center">
                                                                        <img src="~/assets/img/icon/icon-02.svg" alt="Img">
                                                                        <p>
                                                                            @if (hours > 0)
                                                                            {
                                                                                @($"{hours} giờ{(hours > 1 ? "" : "")} ")
                                                                            }
                                                                            @if (minutes > 0)
                                                                            {
                                                                                @($"{minutes} phút{(minutes > 1 ? "" : "")} ")
                                                                            }
                                                                            @if (seconds > 0)
                                                                            {
                                                                                @($"{seconds} giây{(seconds > 1 ? "" : "")}")
                                                                            }
                                                                            @if (hours == 0 && minutes == 0 && seconds == 0)
                                                                            {
                                                                                @("0 giây")
                                                                            }
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script>
                    function filterByDateCourse() {
                        var startDateInput = $('#startDate').val();
                        var endDateInput = $('#endDate').val();

                        // Kiểm tra nếu cả hai ngày đều được chọn
                        if (!startDateInput || !endDateInput) {
                            alert("Vui lòng chọn cả hai ngày để lọc.");
                            return;
                        }

                        var startDate = new Date(startDateInput);
                        var endDate = new Date(endDateInput);

                        // Kiểm tra nếu ngày bắt đầu lớn hơn ngày kết thúc
                        if (startDate > endDate) {
                            alert("Ngày bắt đầu không được lớn hơn ngày kết thúc.");
                            return;
                        }

                        let visibleCoursesCount = 0; // Biến đếm khóa học hiển thị

                        $('.course-box').each(function () {
                            var courseDate = new Date($(this).data('date'));

                            if (courseDate >= startDate && courseDate <= endDate) {
                                $(this).closest('.col-xxl-4').show(); // Hiện khóa học
                                visibleCoursesCount++; // Tăng số lượng khóa học hiển thị
                            } else {
                                $(this).closest('.col-xxl-4').hide(); // Ẩn khóa học
                            }
                        });

                        // Hiển thị thông báo về số lượng khóa học hiển thị
                        if (visibleCoursesCount === 0) {
                            alert("Không có khóa học nào trong khoảng thời gian đã chọn.");
                        } else {
                            alert("Có " + visibleCoursesCount + " khóa học hiển thị.");
                        }
                    }
                </script>



                <div class="dash-pagination">
                    <div class="row align-items-center">
                        <div class="col-6">
                            <p>Page @Model.CurrentPage of @Model.TotalPages</p>
                        </div>
                        <div class="col-6">
                            <ul class="pagination">
                                @for (int i = 1; i <= Model.TotalPages; i++)
                                {
                                    <li class="@(i == Model.CurrentPage ? "active" : "")">
                                        <a href="@Url.Action("Index", new { page = i })">@i</a>
                                    </li>
                                }
                                @if (Model.CurrentPage < Model.TotalPages)
                                {
                                    <li>
                                        <a href="@Url.Action("Index", new { page = Model.CurrentPage + 1 })">
                                            <i class="bx bx-chevron-right"></i>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>